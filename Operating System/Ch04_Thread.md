
### ğŸ”ˆ What is thread ??  

![](https://images.velog.io/images/jfe/post/45b87cde-768c-413c-bdf7-5c96d80d55a9/multithread.png)

í”„ë¡œì„¸ìŠ¤ë³´ë‹¤ ì‘ì€ ê°œë…ìœ¼ë¡œ ì‹¤í–‰ì˜ ê°€ì¥ ì‘ì€ ë‹¨ìœ„ë‹¤.  
í”„ë¡œì„¸ìŠ¤ ê°„ì˜ communicationì€ OSë¥¼ ê±°ì³ì•¼í•´ì„œ ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šì€ë°  
threadëŠ” OSë¥¼ ê±°ì¹  í•„ìš”ê°€ ì—†ì–´ì„œ ì„±ëŠ¥ì´ ë” ì¢‹ë‹¤.  
í•˜ì§€ë§Œ threadë“¤ë¼ë¦¬ ì„œë¡œ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš© ì‹œ ì£¼ì˜í•´ì•¼í•œë‹¤.  

threadë¼ë¦¬ëŠ” ì„œë¡œ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— heap, data, text ì˜ì—­ë“¤ì„ ê°™ì´ ì“¸ ìˆ˜ ìˆëŠ”ë°, ì˜ˆì™¸ì ìœ¼ë¡œ stack ì˜ì—­ì€ ë¶„ë¦¬ë˜ì–´ ìˆê³  register setë„ ê°œë³„ì ìœ¼ë¡œ ê°€ì§€ê³  ìˆë‹¤.  

> â—ï¸ *** ì™œ process ë§ê³  threadë¥¼ ì“¸ê¹Œ ..? ***  
í”„ë¡œì„¸ìŠ¤ëŠ” ìƒì„±ë  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ copyê°€ í•„ìš”í•œë°, threadëŠ” ê´€ë ¨ ì •ë³´ ë°ì´í„° êµ¬ì¡°ë§Œ ì¶”ê°€í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ì¸¡ë©´ì´ë‚˜ ì†ë„ ì¸¡ë©´ì´ë‚˜ threadë¥¼ ë³‘ë ¬í™”í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ì¢‹ë‹¤.  
  * process : fork() & exec() -> 100 ~ 200Âµs  
  * thread : pthread_create() -> 10 ~ 20Âµs  

* #### Multi-threadingì˜ ì¥ì   
  - ë°˜ì‘ì´ ë¹ ë¦„  
    - ê¸°ë³¸ì ìœ¼ë¡œ system callì€ í•œë²ˆ í˜¸ì¶œí•˜ê³  ë‚˜ë©´ ê°’ì´ return ë  ë•Œê¹Œì§€ blocking ìƒíƒœë¡œ ìˆëŠ”ë°,  
    - threadê°€ ì—¬ëŸ¬ ê°œë©´ í•˜ë‚˜ì˜ threadê°€ blocking ë˜ì–´ ìˆì–´ë„ ë‹¤ë¥¸ threadê°€ ë‹¤ë¥¸ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.  
  - ë¦¬ì†ŒìŠ¤ ê³µìœ ê°€ ì‰¬ì›€  
    - ê°™ì€ í”„ë¡œì„¸ìŠ¤ ì•ˆì˜ threadë“¤ì€ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— IPCë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.  
  - íš¨ìœ¨ì , ê²½ì œì   
  - í™•ì¥ì„±(Scalability)ì´ ì¢‹ìŒ  
    - ë™ì¼í•œ í™˜ê²½ì—ì„œ processê°€ threadë³´ë‹¤ ë¨¼ì € í•œê³„ì ì— ë„ë‹¬í•œë‹¤. (ë©”ëª¨ë¦¬ ì†Œë¹„ëŸ‰ì´ ë” í¬ê¸° ë•Œë¬¸ì—)  
    - threadê°€ ë” scalableí•¨  

---

### â›“ Multicore Programming  

coreì˜ ê°œìˆ˜ë§Œí¼ ë³‘ë ¬ì ìœ¼ë¡œ ì‘ì—…í•  ìˆ˜ ìˆëŠ” threadì˜ ê°œìˆ˜ë„ ëŠ˜ì–´ë‚œë‹¤.  
(coreì˜ ê°œìˆ˜ì— ë”°ë¼ ë³‘ë ¬ì„±ì´ ë†’ì•„ì§„ë‹¤.)  

* ### Concurrency / Parallelism  
  - **Concurrency**  
  
    ![](https://images.velog.io/images/jfe/post/48cee791-6005-4952-a3a4-e1c8890d1762/concurrency.png)
  
    : ì—¬ëŸ¬ ê°œì˜ ì¼ë“¤ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ (ë°˜ë“œì‹œ ë™ì‹œì— í•  í•„ìš” x)  
  - **Parallelism**  
  
    ![](https://images.velog.io/images/jfe/post/fd8b7c71-1764-4f22-bf13-0b11cc56709f/parallelism.png)
  
    : ì—¬ëŸ¬ ê°œì˜ ì¼ë“¤ì„ **ë™ì‹œì—** ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥  
  concurrentí•˜ì§€ë§Œ parallelí•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŒ  
  
* ### Hyper-threading  
  
  ![](https://images.velog.io/images/jfe/post/87095ec9-2143-4c92-a9d2-86dafa3a6ad3/hyperthreading.png)
  
  ì‹¤ì œ ë¬¼ë¦¬ì ì¸ ì½”ì–´ë³´ë‹¤ ì½”ì–´ê°€ 2ë°° ë” ë§ê²Œ ë³´ì—¬ì£¼ëŠ” ê¸°ìˆ   

  ILP(Instruction Level Parallelism)ì„ í†µí•´ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ìˆ˜í–‰í•  ë•Œ ì¤‘ê°„ì— ë©”ëª¨ë¦¬ ì•¡ì„¸ìŠ¤ ë“±ìœ¼ë¡œ ì¸í•´ ì‰¬ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ë©´ ë‹¤ë¥¸ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ë°©ì‹ì´ë‹¤.  
  ì›ë˜ í•˜ë‚˜ì˜ CPUì—ì„œ ë‚¨ëŠ” ì‹œê°„ì„ ì˜ í™œìš©í•´ì„œ ë§ˆì¹˜ 2ê°œì˜ CPUê°€ ë™ì‘í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì„±ëŠ¥ì„ ë‚¸ë‹¤.  
  (ì‹¤ì œë¡œ coreê°€ 2ë°°ê°€ ëœ ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ 2ë°°ê¹Œì§€ ì˜¬ë¼ê°€ì§€ëŠ” x)  
  
---

### ğŸªœ Challenges from Multicore  

* #### Identifying tasks  
  - ëª¨ë“  í”„ë¡œê·¸ë¨ ì‹œì‘ë¶€í„° ëê¹Œì§€ ë³‘ë ¬í™” í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥, ì¼ë¶€ë¶„ë§Œ ê°€ëŠ¥  
  - ì–´ë–¤ ë¶€ë¶„ì„ ì–¼ë§ˆë‚˜ ë³‘ë ¬í™” í•  ìˆ˜ ìˆëŠ”ì§€ì— ë”°ë¼ benefitì´ ë‹¤ë¦„  
* #### Balance  
  - threadë§ˆë‹¤ í•˜ëŠ” ì¼ì´ ë¹„ìŠ·í•´ì•¼ í•¨  
  - ì–´ë–¤ threadëŠ” ë³µì¡í•œ ì¼ì„ í•˜ê³ , ì–´ë–¤ threadëŠ” ê°„ë‹¨í•œ ì¼ì„ í•˜ë©´ ì‰¬ëŠ” ì½”ì–´ê°€ ìƒê¹€  
  - ë™ì¼í•œ ê°™ì€ ì¼ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì´ best  
* #### Data splitting  
  - ë°ì´í„°ë„ ì˜ ë‚˜ëˆ ì¤˜ì•¼ í•¨  
  - në“±ë¶„ í•œë‹¤ê³  í•´ê²°ë˜ì§€ëŠ” ì•ŠìŒ  
  (ë‹¤ì–‘í•œ ìˆ«ìì˜ ë°ì´í„°ê°€ ìˆëŠ”ë° í•˜ë‚˜ëŠ” ì‰¬ìš´ ìˆ«ìì˜ ë°ì´í„°ê³  í•˜ë‚˜ëŠ” ë³µì¡í•œ ìˆ«ìë¥¼ ê³„ì‚°í•´ì•¼ í•˜ë©´ ì°¨ì´ê°€ ìˆìŒ)  
  - ë°ì´í„° ë‚´ìš©ì„ ë³´ê³  ì˜ split í•´ì•¼ í•¨  
* #### Data dependency  
  - ë°ì´í„°ê°€ í•œ ìª½ì—ì„œ ì²˜ë¦¬ë˜ì–´ ëë‚˜ë©´ ê·¸ ê²°ê³¼ë¥¼ ë‹¤ë¥¸ threadì— ë„˜ê²¨ì¤˜ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆìŒ  
  - ì´ëŸ° ê²½ìš°ì—ëŠ” ë³‘ë ¬ì ìœ¼ë¡œ ì‘ì—…ì„ ì œëŒ€ë¡œ í•  ìˆ˜ê°€ ì—†ìŒ  
  - synchronizeë¥¼ í†µí•´ threadê°„ì˜ í†µì œê°€ í•„ìš”  
* #### Testing & debugging  
  - ë‹¤ì–‘í•œ execution pathë¡œ ì¸í•´ race conditionì— ì§ë©´í•  ìˆ˜ ìˆìŒ  
  - ì–´ë–¤ ë•ŒëŠ” ì‹¤í–‰ë˜ë‹¤ê°€ ì–´ë–¤ ë•ŒëŠ” ì•ˆë˜ê³  í•˜ë‹ˆê¹Œ í…ŒìŠ¤íŒ…ì´ í˜ë“¤ë‹¤.  
  - ë˜í•œ thread ìˆœì„œì— ë”°ë¼ ë²„ê·¸ ë°œí˜„ì´ ë‹¬ë¼ì§  

---

### ğŸ“‚ Parallelism ì¢…ë¥˜  

* **Data parallelism**  
  : dataë¥¼ ì˜ë¼ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” computing coreì— ì˜ ë¶„ë°°í•˜ëŠ” ê²ƒ  
* **Task parallelism**  
  : ê°™ì€ ë°ì´í„°ë¥¼ ì“°ì§€ë§Œ, ì½”ì–´ë§ˆë‹¤ ë‹¤ë¥¸ ì¼ì„ ë‚˜ëˆ ì„œ ì£¼ëŠ” ê²ƒ  

ì‹¤ì œë¡œëŠ” Data parallelismê³¼ Task parallelismì´ hybridë¡œ ì“°ì„  

---

### ğŸ” Multithreading Models  

* #### User thread / Kernel thread  

  ![](https://images.velog.io/images/jfe/post/ab407f66-3ef2-41c0-87f8-5da1ad298dcf/user%20kernel%20thread.png)

  - User thread  
    - threadì˜ ìƒíƒœì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” data structureê°€ user level process ë©”ëª¨ë¦¬ ì˜ì—­ì— ì €ì¥ë¨  
    - thread ê´€ë¦¬ì— í•„ìš”í•œ í•¨ìˆ˜(ìƒì„±, ì‚­ì œ, ìŠ¤ì¼€ì¥´ë§)ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜•íƒœë¡œ í”„ë¡œê·¸ë¨ ë‚´ì— ì¡´ì¬  
    - OS kernel ì…ì¥ì—ì„œëŠ” user threadê°€ ëª‡ ê°œ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ  
    - ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ìì‹ ì´ ë§Œë“  user thread ëª©ë¡ì„ ìì²´ì ìœ¼ë¡œ ê´€ë¦¬  
    > ***ğŸ“¢ User threadì˜ ì¥/ë‹¨ì ***
      * ì¥ì   
        : ëª¨ë“  thread ê´€ë ¨ ì‘ì—…ë“¤ì´ system callì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë‹¨ìˆœí•œ library callì´ê¸° ë•Œë¬¸ì— ë¹„êµì  ë¹ ë¥´ê³  ê°€ë³ë‹¤.  
      * ë‹¨ì   
        : kernelì´ user threadì˜ ì¡´ì¬ë¥¼ ì•Œ ìˆ˜ ì—†ì–´ì„œ ìŠ¤ì¼€ì¥´ë§ì„ ë‹¤ë¥´ê²Œ í•  ìˆ˜ë„ ì—†ê³ , í•œ í”„ë¡œì„¸ìŠ¤ê°€ block ë˜ì–´ë²„ë¦¬ë©´ process ë‚´ì— ìˆëŠ” user threadë“¤ì´ ë‹¤ ê°™ì´ ë©ˆì¶”ê²Œ ëœë‹¤.  
    
  - Kernel thread  
    - threadì˜ data structure, ê´€ë ¨ í•¨ìˆ˜ë“¤ì´ kernel ì˜ì—­ì— ì¡´ì¬  
    - kernelì´ ê°ê°ì˜ ëª¨ë“  thread ê´€ë¦¬  
    - kernel ë‚´ë¶€ì— í˜„ì¬ê¹Œì§€ ë§Œë“¤ì–´ì§„ threadë“¤ì˜ tableì´ ìˆì–´ì„œ ì–´ë–¤ threadê°€ ì–´ëŠ í”„ë¡œì„¸ìŠ¤ì— ì†í•´ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ë„ ê°€ì§€ê³  ìˆìŒ  
    > ***ğŸ“¢ Kernel threadì˜ ì¥/ë‹¨ì ***
      * ì¥ì   
        : kernelì´ threadë¥¼ ì¸ì‹í•  ìˆ˜ ìˆì–´ì„œ í•˜ë‚˜ì˜ threadê°€ block ë˜ì–´ë²„ë¦¬ë©´ ë‹¤ë¥¸ threadë¥¼ ìŠ¤ì¼€ì¥´ë§í•´ì„œ CPUê°€ ì‰¬ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.  
        ë˜í•œ, í”„ë¡œì„¸ìŠ¤ ë‚´ì˜ thread ê°œìˆ˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìŠ¤ì¼€ì¥´ë§ í•  ìˆ˜ ìˆë‹¤.  
      * ë‹¨ì   
        : ìƒì„±í•˜ëŠ”ë° ë¹„êµì  ì‹œê°„ì´ ë” ê±¸ë¦¬ê³ , user threadì˜ data structureë³´ë‹¤ fieldê°€ ë” ë§ê³  í¬ë‹¤.  
        
* #### Multiplexing User Threads  

  user threadëŠ” ì‹¤ì œ ì¼ì„ ìˆ˜í–‰í•˜ëŠ” threadê°€ ì•„ë‹ˆë‹¤.  
application ìª½ì—ì„œ ë³‘ë ¬ì„±ì˜ ì •ë„ê°€ ì–´ëŠ ì •ë„ ë˜ì–´ì•¼ í•œë‹¤ëŠ” í•„ìš”í•œ ë³‘ë ¬ì„± ì •ë„ë¥¼ ìë£Œêµ¬ì¡°ë¡œ ë§Œë“¤ì–´ ë†“ì€ ê²ƒì´ë‹¤.  
ì‹¤ì œë¡œ ì¼ì„ í•  ìˆ˜ ìˆëŠ” ê²ƒì€ kernel threadë¡œ kernel thread ìì²´ê°€ kernelì— ì˜í•´ ìŠ¤ì¼€ì¥´ë§ ë˜ì–´ ì‚¬ìš©ëœë‹¤.  
=> ê·¸ë˜ì„œ user threadë¥¼ kernel threadì— mapping í•´ì¤˜ì•¼ kernel threadê°€ ìŠ¤ì¼€ì¥´ë§ ë˜ë©´ì„œ user threadê°€ ì˜ë„í•œ ì¼ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.  

  > ***â—ï¸mapping ë°©ë²•ì€ ì–´ë–»ê²Œ ë ê¹Œ ?? ***  
  1. user thread ë‚´ì— ìˆëŠ” threadì˜ ìƒíƒœ ì •ë³´ë¥¼ kernel threadì˜ data structure ë‚´ë¶€ë¡œ ì˜®ê²¨ì¤€ë‹¤.  
  2. kernel thread ì•ˆì˜ pointerê°€ user thread êµ¬ì¡°ì²´ë¥¼ ê°€ë¦¬í‚¤ê²Œ í•œë‹¤.  
  
* #### N-to-one model  
  
  ![](https://images.velog.io/images/jfe/post/a0a0b8bc-6ece-49d4-92be-ca4fea5cb313/ntoone.png)
  
  - **ì¥ì **  
    - system callì´ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹„êµì  ë¹ ë¥´ë‹¤.  
    - Portableí•¨ (ë‹¤ë¥¸ OSì—ì„œë„ ë˜‘ê°™ì´ user threadë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš© ê°€ëŠ¥)  
    (user thread ìì²´ëŠ” kernelì˜ ë„ì›€ì„ ë°›ì•„ì„œ ìƒì„±ë˜ëŠ” ê²Œ ì•„ë‹ˆë¼ application processê°€ ìì²´ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸)  
  - **ë‹¨ì **  
    - kernel thread 1ê°œë§Œ ìŠ¤ì¼€ì¥´ë§ ê°€ëŠ¥  
    - í”„ë¡œì„¸ìŠ¤ê°€ block ë˜ë©´ ëª¨ë“  threadê°€ block ëœë‹¤.  
  

* #### 1-1 model  
  
  ![](https://images.velog.io/images/jfe/post/62b1c46a-7d10-48e7-af9b-4a388eeb5dca/oneone.png)
  
  - **ì¥ì **  
    - í•˜ë‚˜ê°€ block ë˜ì–´ë„ ë‹¤ë¥¸ threadë¥¼ ìŠ¤ì¼€ì¥´ë§ í•´ì„œ ë™ì‘ì‹œí‚¤ë©´ ëœë‹¤.  
    - pararellí•˜ê²Œ ìˆ˜í–‰ ê°€ëŠ¥ (ì—¬ëŸ¬ threadë“¤ì´ ë¹ ë¥´ê²Œ time-sharingí•˜ë©´ì„œ concurrentí•˜ê²Œ ìˆ˜í–‰ë˜ì–´ ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” ë°©ì‹ ë§ê³  ì§„ì§œ ë³‘ë ¬ì ìœ¼ë¡œ ìˆ˜í–‰)  
  - **ë‹¨ì **  
    - user threadì— ë¹„í•´ thread ìƒì„±ì´ ëŠë¦¼  
    - user threadê°€ ë§ì•„ì§ˆìˆ˜ë¡ kernel threadë„ ë§ì•„ì§€ê³  ê·¸ëŸ´ìˆ˜ë¡ kernel ë©”ëª¨ë¦¬ë¥¼ ë§ì´ ì“°ê²Œ ë˜ì–´ì„œ, user threadë¥¼ ë§ì´ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.  (thread ê°œìˆ˜ì— í•œê³„ê°€ ìˆìŒ)  

* #### Many-to-many model  

  ![](https://images.velog.io/images/jfe/post/0b4876a8-07ae-4ea7-bd59-ca0357d78617/manytom.png)
  
  - **ì¥ì **  
    - user thread (applicationì´ í•„ìš”í•œ ë§Œí¼)ì™€ kernel thread (ë¬¼ë¦¬ì ìœ¼ë¡œ ê°€ëŠ¥í•œ ë§Œí¼) ë‘˜ ë‹¤ ì„œë¡œ ìì‹ ì—ê²Œ ë§ëŠ” ê°œìˆ˜ ë§Œí¼ë§Œ ìƒì„±í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— Flexible í•¨  
  - **ë‹¨ì **  
    - ë™ì ìœ¼ë¡œ ê´€ë¦¬ê°€ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ë³µì¡í•¨  
    
---

